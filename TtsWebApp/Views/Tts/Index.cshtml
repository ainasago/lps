@{
    ViewData["Title"] = "å…è´¹åœ¨çº¿AIæ–‡å­—è½¬è¯­éŸ³";
}

<!-- Hero Section / Core Tool -->
<section class="py-12 md:py-20 px-4 bg-gradient-to-br from-primary/5 via-transparent to-purple-500/5">
<div class="container mx-auto flex flex-col items-center text-center gap-6 max-w-4xl">
<div class="inline-flex items-center gap-2 px-4 py-2 bg-primary/10 dark:bg-primary/20 rounded-full">
<span class="material-symbols-outlined text-primary text-xl">auto_awesome</span>
<span class="text-primary font-semibold text-sm">ç¥ç»ç½‘ç»œè¯­éŸ³åˆæˆ</span>
</div>
<h1 class="text-slate-900 dark:text-white text-4xl md:text-6xl font-extrabold leading-tight tracking-tight" data-i18n="home.title">
è®©æ–‡å­—å‘å£°ï¼Œ<br/>è®©åˆ›æ„æ— é™
</h1>
<p class="text-slate-600 dark:text-slate-400 text-lg md:text-xl leading-relaxed max-w-2xl" data-i18n="home.subtitle">
åŸºäºç¥ç»ç½‘ç»œ TTSï¼Œæ”¯æŒå¤šç§è¯­è¨€å’Œè‡ªç„¶äººå£°<br/>
ä¸ºæ‚¨çš„å†…å®¹åˆ›ä½œæä¾›å®Œç¾é…éŸ³è§£å†³æ–¹æ¡ˆ
</p>
</div>

<div class="container mx-auto mt-12 max-w-6xl">
<!-- ä¸»è½¬æ¢å¡ç‰‡ -->
<div class="bg-white dark:bg-slate-900 rounded-2xl shadow-2xl shadow-primary/10 dark:shadow-primary/5 border border-slate-200 dark:border-slate-800 overflow-hidden">
<form id="ttsForm" class="p-6 md:p-8">
<!-- æ–‡æœ¬è¾“å…¥åŒº -->
<div class="mb-8">
<div class="flex items-center justify-between mb-3">
<label class="flex items-center gap-2 text-slate-900 dark:text-white font-semibold text-lg">
<span class="material-symbols-outlined text-primary">edit_note</span>
<span data-i18n="home.inputLabel">è¾“å…¥æ–‡æœ¬</span>
</label>
<span class="text-slate-500 dark:text-slate-400 text-sm font-medium" id="charCount">0 / 5000</span>
</div>
<textarea 
    class="form-input w-full resize-none rounded-xl text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 focus:border-primary border-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 min-h-48 placeholder:text-slate-400 dark:placeholder:text-slate-500 p-5 text-base leading-relaxed transition-all" 
    id="textInput" 
    placeholder="åœ¨è¿™é‡Œè¾“å…¥æˆ–ç²˜è´´æ‚¨æƒ³è¦è½¬æ¢ä¸ºè¯­éŸ³çš„æ–‡æœ¬å†…å®¹..."
    data-i18n="home.placeholder"
    maxlength="5000"></textarea>
</div>

<!-- é…ç½®é€‰é¡¹åŒº -->
<div class="grid grid-cols-1 md:grid-cols-2 gap-5 mb-6">
<!-- è¯­è¨€é€‰æ‹© -->
<div class="space-y-2">
<label class="flex items-center gap-2 text-slate-700 dark:text-slate-300 font-medium text-sm" for="languageSelect">
<span class="material-symbols-outlined text-lg text-primary">language</span>
<span data-i18n="home.language">è¯­è¨€</span>
</label>
<select class="form-select w-full rounded-lg text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 py-2.5 px-4 transition-all" id="languageSelect">
<option value="">é€‰æ‹©è¯­è¨€...</option>
</select>
</div>

<!-- é…éŸ³å‘˜é€‰æ‹© -->
<div class="space-y-2">
<label class="flex items-center gap-2 text-slate-700 dark:text-slate-300 font-medium text-sm">
<span class="material-symbols-outlined text-lg text-primary">record_voice_over</span>
<span data-i18n="home.voice">é…éŸ³å‘˜</span>
</label>
<select class="form-select w-full rounded-lg text-slate-900 dark:text-white focus:outline-0 focus:ring-2 focus:ring-primary/50 border-2 border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-800/50 py-2.5 px-4 transition-all" id="voiceSelect">
<option value="">é€‰æ‹©é…éŸ³å‘˜...</option>
</select>
</div>
</div>

<!-- å‚æ•°è°ƒèŠ‚åŒº -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
<!-- éŸ³è°ƒ -->
<div class="space-y-3">
<div class="flex items-center justify-between">
<label class="flex items-center gap-2 text-slate-700 dark:text-slate-300 font-medium text-sm">
<span class="material-symbols-outlined text-lg text-amber-500">tune</span>
<span data-i18n="home.pitch">éŸ³è°ƒ</span>
</label>
<span class="text-primary font-bold text-sm" id="pitchValue">0</span>
</div>
<input class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full appearance-none cursor-pointer accent-primary slider-thumb" id="pitchRange" max="50" min="-50" step="1" type="range" value="0"/>
</div>

<!-- è¯­é€Ÿ -->
<div class="space-y-3">
<div class="flex items-center justify-between">
<label class="flex items-center gap-2 text-slate-700 dark:text-slate-300 font-medium text-sm">
<span class="material-symbols-outlined text-lg text-blue-500">speed</span>
<span data-i18n="home.rate">è¯­é€Ÿ</span>
</label>
<span class="text-primary font-bold text-sm" id="rateValue">0</span>
</div>
<input class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full appearance-none cursor-pointer accent-primary slider-thumb" id="rateRange" max="200" min="-100" step="1" type="range" value="0"/>
</div>

<!-- éŸ³é‡ -->
<div class="space-y-3">
<div class="flex items-center justify-between">
<label class="flex items-center gap-2 text-slate-700 dark:text-slate-300 font-medium text-sm">
<span class="material-symbols-outlined text-lg text-green-500">volume_up</span>
<span data-i18n="home.volume">éŸ³é‡</span>
</label>
<span class="text-primary font-bold text-sm" id="volumeValue">80</span>
</div>
<input class="w-full h-2 bg-slate-200 dark:bg-slate-700 rounded-full appearance-none cursor-pointer accent-primary slider-thumb" id="volumeRange" max="100" min="0" step="1" type="range" value="80"/>
</div>
</div>

<!-- é€‰é¡¹ -->
<div class="flex items-center gap-4 mb-6">
<label class="flex items-center gap-2 cursor-pointer group">
<input type="checkbox" id="generateSubtitles" class="w-5 h-5 text-primary bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded focus:ring-2 focus:ring-primary/50 transition-all">
<span class="text-slate-700 dark:text-slate-300 font-medium text-sm group-hover:text-primary transition-colors" data-i18n="home.generateSubtitles">ç”Ÿæˆå­—å¹•æ–‡ä»¶</span>
</label>
</div>

<!-- é«˜çº§åŠŸèƒ½ï¼ˆå¯æŠ˜å ï¼‰ -->
<details class="group">
<summary class="flex items-center gap-2 cursor-pointer text-slate-700 dark:text-slate-300 font-semibold text-sm mb-4 hover:text-primary transition-colors">
<span class="material-symbols-outlined text-lg group-open:rotate-90 transition-transform">chevron_right</span>
<span class="material-symbols-outlined text-lg text-purple-500">settings_suggest</span>
<span>é«˜çº§é€‰é¡¹</span>
</summary>
<div class="pl-8 space-y-4 pb-4">
<!-- è¯•å¬æ¨¡å¼ -->
<div class="flex items-center gap-3 flex-wrap">
<label class="flex items-center gap-2 cursor-pointer">
<input type="checkbox" id="previewMode" class="w-4 h-4 text-primary bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded focus:ring-2 focus:ring-primary/50">
<span class="text-slate-700 dark:text-slate-300 text-sm font-medium">è¯•å¬æ¨¡å¼ï¼ˆå‰</span>
</label>
<input type="number" id="previewSentences" class="w-16 px-3 py-1.5 text-sm border-2 border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary" value="3" min="1" max="10">
<span class="text-slate-700 dark:text-slate-300 text-sm font-medium">å¥ï¼‰</span>
</div>

<!-- åœé¡¿é—´éš” -->
<div class="flex items-center gap-3 flex-wrap">
<label class="text-slate-700 dark:text-slate-300 text-sm font-medium">å¥é—´åœé¡¿ï¼š</label>
<input type="number" id="breakTime" class="w-24 px-3 py-1.5 text-sm border-2 border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary" value="0" min="0" max="2000" step="100">
<span class="text-slate-700 dark:text-slate-300 text-sm font-medium">æ¯«ç§’</span>
<span class="text-slate-500 dark:text-slate-400 text-xs">(0=æ— åœé¡¿)</span>
</div>

<!-- é•¿æ–‡æœ¬åˆ‡ç‰‡ -->
<div class="flex items-center gap-3 flex-wrap">
<label class="flex items-center gap-2 cursor-pointer">
<input type="checkbox" id="enableLongTextSplit" class="w-4 h-4 text-primary bg-slate-100 dark:bg-slate-800 border-2 border-slate-300 dark:border-slate-600 rounded focus:ring-2 focus:ring-primary/50">
<span class="text-slate-700 dark:text-slate-300 text-sm font-medium">é•¿æ–‡æœ¬åˆ‡ç‰‡ï¼ˆæ¯ç‰‡</span>
</label>
<input type="number" id="maxCharsPerChunk" class="w-20 px-3 py-1.5 text-sm border-2 border-slate-200 dark:border-slate-600 rounded-lg bg-slate-50 dark:bg-slate-800 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/50 focus:border-primary" value="500" min="100" max="2000" step="100">
<span class="text-slate-700 dark:text-slate-300 text-sm font-medium">å­—ï¼‰</span>
</div>
</div>
</details>

<!-- ç”ŸæˆæŒ‰é’® -->
<div class="pt-6 border-t border-slate-200 dark:border-slate-700">
<button type="button" id="convertBtn" class="w-full flex items-center justify-center gap-3 px-8 py-4 bg-gradient-to-r from-primary to-purple-600 hover:from-primary/90 hover:to-purple-600/90 text-white text-lg font-bold rounded-xl shadow-lg shadow-primary/30 hover:shadow-xl hover:shadow-primary/40 transition-all transform hover:scale-[1.02] active:scale-[0.98]">
<span class="material-symbols-outlined text-2xl">graphic_eq</span>
<span class="truncate" data-i18n="home.generateSpeech">ç”Ÿæˆè¯­éŸ³</span>
<span class="material-symbols-outlined text-2xl">arrow_forward</span>
</button>
</div>
<!-- éŸ³é¢‘æ’­æ”¾å™¨ -->
<div id="inlinePlayer" class="mt-6 p-6 bg-gradient-to-br from-primary/5 to-purple-500/5 dark:from-primary/10 dark:to-purple-500/10 rounded-xl border-2 border-primary/20 dark:border-primary/30" style="display: none;">
<div class="flex items-center gap-4">
<button type="button" id="playBtn" class="flex items-center justify-center size-14 rounded-full bg-gradient-to-br from-primary to-purple-600 text-white hover:shadow-lg hover:shadow-primary/50 transition-all transform hover:scale-110 active:scale-95">
<span class="material-symbols-outlined text-3xl">play_arrow</span>
</button>
<div class="flex-grow">
<div class="h-2 bg-slate-300 dark:bg-slate-700 rounded-full overflow-hidden">
<div id="progressBar" class="h-full bg-gradient-to-r from-primary to-purple-600 rounded-full transition-all" style="width: 0%"></div>
</div>
<div class="flex justify-between items-center mt-2">
<p class="text-sm font-medium text-slate-700 dark:text-slate-300" id="timeDisplay">0:00 / 0:00</p>
<button type="button" id="downloadAudioBtn" class="flex items-center gap-2 px-4 py-2 bg-white dark:bg-slate-800 text-primary hover:bg-primary hover:text-white border-2 border-primary rounded-lg font-semibold text-sm transition-all transform hover:scale-105">
<span class="material-symbols-outlined text-lg">download</span>
<span>ä¸‹è½½éŸ³é¢‘</span>
</button>
</div>
</div>
</div>
</div>
<audio id="audioPlayer" style="display: none;"></audio>

<!-- å­—å¹•æ˜¾ç¤ºåŒº -->
<div id="subtitlesContainer" class="mt-6 bg-amber-50 dark:bg-amber-900/10 border-2 border-amber-200 dark:border-amber-800 rounded-xl p-6" style="display: none;">
<div class="flex justify-between items-center mb-4">
<h4 class="flex items-center gap-2 text-slate-900 dark:text-white text-lg font-bold">
<span class="material-symbols-outlined text-amber-600">subtitles</span>
<span>å­—å¹•å†…å®¹</span>
</h4>
<button type="button" id="downloadSubtitlesBtn" class="flex items-center gap-2 px-4 py-2 bg-amber-600 hover:bg-amber-700 text-white text-sm font-semibold rounded-lg transition-all transform hover:scale-105">
<span class="material-symbols-outlined text-lg">download</span>
<span>ä¸‹è½½å­—å¹•</span>
</button>
</div>
<div id="subtitlesContent" class="text-slate-700 dark:text-slate-300 text-sm leading-relaxed whitespace-pre-wrap max-h-64 overflow-y-auto p-4 bg-white dark:bg-slate-800/50 rounded-lg border border-amber-200 dark:border-amber-800"></div>
</div>
</form>
</div>
</div>
</section>

<style>
/* è‡ªå®šä¹‰æ»‘å—æ ·å¼ - äº®è‰²ä¸»é¢˜ */
input[type="range"].slider-thumb::-webkit-slider-thumb {
    appearance: none;
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary, #5b13ec), #9333ea);
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(91, 19, 236, 0.4);
    transition: all 0.2s;
}

input[type="range"].slider-thumb::-webkit-slider-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 12px rgba(91, 19, 236, 0.6);
}

input[type="range"].slider-thumb::-moz-range-thumb {
    width: 18px;
    height: 18px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary, #5b13ec), #9333ea);
    cursor: pointer;
    border: none;
    box-shadow: 0 2px 8px rgba(91, 19, 236, 0.4);
    transition: all 0.2s;
}

input[type="range"].slider-thumb::-moz-range-thumb:hover {
    transform: scale(1.2);
    box-shadow: 0 4px 12px rgba(91, 19, 236, 0.6);
}

/* æš—è‰²ä¸»é¢˜æ»‘å—æ ·å¼ */
@@media (prefers-color-scheme: dark) {
    input[type="range"].slider-thumb::-webkit-slider-thumb {
        box-shadow: 0 2px 12px rgba(147, 51, 234, 0.5);
    }
    
    input[type="range"].slider-thumb::-webkit-slider-thumb:hover {
        box-shadow: 0 4px 16px rgba(147, 51, 234, 0.7);
    }
    
    input[type="range"].slider-thumb::-moz-range-thumb {
        box-shadow: 0 2px 12px rgba(147, 51, 234, 0.5);
    }
    
    input[type="range"].slider-thumb::-moz-range-thumb:hover {
        box-shadow: 0 4px 16px rgba(147, 51, 234, 0.7);
    }
}

/* æš—è‰²ä¸»é¢˜ç±»é€‰æ‹©å™¨ */
.dark input[type="range"].slider-thumb::-webkit-slider-thumb {
    box-shadow: 0 2px 12px rgba(147, 51, 234, 0.5);
}

.dark input[type="range"].slider-thumb::-webkit-slider-thumb:hover {
    box-shadow: 0 4px 16px rgba(147, 51, 234, 0.7);
}

.dark input[type="range"].slider-thumb::-moz-range-thumb {
    box-shadow: 0 2px 12px rgba(147, 51, 234, 0.5);
}

.dark input[type="range"].slider-thumb::-moz-range-thumb:hover {
    box-shadow: 0 4px 16px rgba(147, 51, 234, 0.7);
}

/* è¿›åº¦æ¡åŠ¨ç”» */
#progressBar {
    transition: width 0.1s linear;
}

/* æŠ˜å åŠ¨ç”» */
details[open] summary ~ * {
    animation: slideDown 0.3s ease-out;
}

@@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* æš—è‰²ä¸»é¢˜ä¸‹çš„å¡ç‰‡ä¼˜åŒ– */
@@media (prefers-color-scheme: dark) {
    .bg-white {
        background-color: rgb(15 23 42) !important;
    }
}

.dark .bg-white {
    background-color: rgb(15 23 42) !important;
}
</style>

<!-- Features Section -->
<section class="py-16 px-4 bg-white/50 dark:bg-white/5">
<div class="container mx-auto">
<div class="text-center mb-12">
<h2 class="text-3xl font-bold text-slate-900 dark:text-white">ä¸ºä»€ä¹ˆé€‰æ‹©æˆ‘ä»¬</h2>
<p class="text-slate-600 dark:text-slate-400 mt-2">æ¢ç´¢è®©æˆ‘ä»¬çš„ TTS æœåŠ¡è„±é¢–è€Œå‡ºçš„åŠŸèƒ½ç‰¹æ€§</p>
</div>
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
<div class="flex flex-col items-center text-center p-6">
<div class="flex items-center justify-center size-14 rounded-xl bg-primary/20 mb-4">
<span class="material-symbols-outlined text-primary text-3xl">language</span>
</div>
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight">å…¨çƒè¯­è¨€è¦†ç›–</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">æ”¯æŒå…¨çƒæ•°åç§è¯­è¨€å’Œæ–¹è¨€</p>
</div>
<div class="flex flex-col items-center text-center p-6">
<div class="flex items-center justify-center size-14 rounded-xl bg-primary/20 mb-4">
<span class="material-symbols-outlined text-primary text-3xl">psychology</span>
</div>
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight">ç¥ç»ç½‘ç»œè‡ªç„¶è¯­éŸ³</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">åŸºäºå¾®è½¯ç¥ç»ç½‘ç»œæŠ€æœ¯ï¼Œç”Ÿæˆæå…¶é€¼çœŸçš„äººå£°</p>
</div>
<div class="flex flex-col items-center text-center p-6">
<div class="flex items-center justify-center size-14 rounded-xl bg-primary/20 mb-4">
<span class="material-symbols-outlined text-primary text-3xl">folder_zip</span>
</div>
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight">å¤šç§éŸ³é¢‘æ ¼å¼</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">å¯¼å‡º MP3ã€WAV ç­‰æµè¡Œæ ¼å¼çš„éŸ³é¢‘</p>
</div>
<div class="flex flex-col items-center text-center p-6">
<div class="flex items-center justify-center size-14 rounded-xl bg-primary/20 mb-4">
<span class="material-symbols-outlined text-primary text-3xl">api</span>
</div>
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight">å¼€å‘è€… API</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">è½»æ¾å°†æˆ‘ä»¬å¼ºå¤§çš„ TTS å¼•æ“é›†æˆåˆ°æ‚¨çš„åº”ç”¨ä¸­</p>
</div>
</div>
</div>
</section>

<!-- Use Cases Section -->
<section class="py-16 px-4">
<div class="container mx-auto">
<div class="text-center mb-12">
<h2 class="text-3xl font-bold text-slate-900 dark:text-white">é€‚ç”¨äºä»»ä½•åœºæ™¯</h2>
<p class="text-slate-600 dark:text-slate-400 mt-2">ä»åˆ›æ„é¡¹ç›®åˆ°å•†ä¸šåº”ç”¨ï¼Œæˆ‘ä»¬éƒ½èƒ½æ»¡è¶³æ‚¨çš„éœ€æ±‚</p>
</div>
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
<div class="flex flex-col items-stretch justify-start rounded-xl bg-white/50 dark:bg-white/5 border border-slate-200 dark:border-slate-800 overflow-hidden">
<div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f3a4.svg'); background-size: 100px; background-color: #5b13ec20;"></div>
<div class="p-6">
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">è§†é¢‘å’Œæ’­å®¢æ—ç™½</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">æ— éœ€éº¦å…‹é£å³å¯ä¸ºæ‚¨çš„å†…å®¹åˆ›å»ºä¸“ä¸šé…éŸ³</p>
</div>
</div>
<div class="flex flex-col items-stretch justify-start rounded-xl bg-white/50 dark:bg-white/5 border border-slate-200 dark:border-slate-800 overflow-hidden">
<div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4da.svg'); background-size: 100px; background-color: #5b13ec20;"></div>
<div class="p-6">
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">åœ¨çº¿å­¦ä¹ ä¸æ•™è‚²</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">ä¸ºè¯¾ç¨‹å’Œæ•™è‚²å†…å®¹åˆ¶ä½œå¼•äººå…¥èƒœçš„éŸ³é¢‘ææ–™</p>
</div>
</div>
<div class="flex flex-col items-stretch justify-start rounded-xl bg-white/50 dark:bg-white/5 border border-slate-200 dark:border-slate-800 overflow-hidden">
<div class="w-full bg-center bg-no-repeat aspect-video bg-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/svg/1f4e2.svg'); background-size: 100px; background-color: #5b13ec20;"></div>
<div class="p-6">
<p class="text-slate-900 dark:text-white text-lg font-bold leading-tight tracking-[-0.015em]">è¥é”€ä¸å¹¿å‘Š</p>
<p class="text-slate-600 dark:text-slate-400 mt-1 text-sm">åœ¨å‡ åˆ†é’Ÿå†…åˆ¶ä½œå¼•äººæ³¨ç›®çš„éŸ³é¢‘å¹¿å‘Šå’Œå®£ä¼ å†…å®¹</p>
</div>
</div>
</div>
</div>
</section>

@section Scripts {
<script>
let voices = [];
let currentAudioData = null;
let currentSubtitles = null;

$(document).ready(function() {
    loadVoices();
    
    $('#textInput').on('input', function() {
        $('#charCount').text($(this).val().length + ' / 5000');
    });
    
    $('#pitchRange').on('input', function() {
        $('#pitchValue').text($(this).val());
    });
    
    $('#rateRange').on('input', function() {
        $('#rateValue').text($(this).val());
    });
    
    $('#volumeRange').on('input', function() {
        $('#volumeValue').text($(this).val());
    });
    
    $('#languageSelect').on('change', function() {
        updateVoiceList($(this).val());
    });
    
    $('#convertBtn').on('click', function() {
        convertText();
    });
    
    $('#playBtn').on('click', function() {
        playAudio();
    });
    
    $('#downloadAudioBtn').on('click', function() {
        downloadAudio();
    });
    
    $('#downloadSubtitlesBtn').on('click', function() {
        downloadSubtitles();
    });
    
    const audioPlayer = document.getElementById('audioPlayer');
    audioPlayer.addEventListener('timeupdate', updateProgress);
    audioPlayer.addEventListener('ended', function() {
        $('#playBtn .material-symbols-outlined').text('play_arrow');
    });
});

function loadVoices() {
    $.get('/Tts/GetVoices', function(data) {
        voices = data;
        populateLanguageSelect();
    }).fail(function() {
        alert('åŠ è½½è¯­éŸ³åˆ—è¡¨å¤±è´¥');
    });
}

function populateLanguageSelect() {
    const languages = [...new Set(voices.map(v => v.locale))];
    const languageSelect = $('#languageSelect');
    languageSelect.empty().append('<option value="">é€‰æ‹©è¯­è¨€...</option>');
    languages.sort();
    const localeNameMap = {};
    voices.forEach(voice => {
        if (!localeNameMap[voice.locale] && voice.localeName) {
            localeNameMap[voice.locale] = voice.localeName;
        }
    });
    languages.forEach(lang => {
        const displayName = localeNameMap[lang] || lang;
        languageSelect.append(`<option value="${lang}">${displayName}</option>`);
    });
    
    // è‡ªåŠ¨æ£€æµ‹æµè§ˆå™¨è¯­è¨€å¹¶é€‰æ‹©é»˜è®¤è¯­è¨€
    autoSelectLanguage();
}

function autoSelectLanguage() {
    // è·å–æµè§ˆå™¨è¯­è¨€
    const browserLang = navigator.language || navigator.userLanguage;
    
    // è¯­è¨€æ˜ å°„è¡¨
    const langMap = {
        'zh': 'zh-CN',
        'zh-CN': 'zh-CN',
        'zh-TW': 'zh-TW',
        'zh-HK': 'zh-HK',
        'en': 'en-US',
        'en-US': 'en-US',
        'en-GB': 'en-GB',
        'ja': 'ja-JP',
        'ko': 'ko-KR',
        'fr': 'fr-FR',
        'de': 'de-DE',
        'es': 'es-ES'
    };
    
    // å°è¯•ç²¾ç¡®åŒ¹é…
    let matchedLocale = null;
    const browserLangLower = browserLang.toLowerCase();
    
    // é¦–å…ˆå°è¯•å®Œå…¨åŒ¹é…
    for (const [key, value] of Object.entries(langMap)) {
        if (browserLangLower === key.toLowerCase()) {
            matchedLocale = value;
            break;
        }
    }
    
    // å¦‚æœæ²¡æœ‰å®Œå…¨åŒ¹é…ï¼Œå°è¯•åŒ¹é…è¯­è¨€ä»£ç ï¼ˆå¦‚ zh-CN åŒ¹é… zhï¼‰
    if (!matchedLocale) {
        const langCode = browserLangLower.split('-')[0];
        matchedLocale = langMap[langCode];
    }
    
    // è·å–å¯ç”¨è¯­è¨€åˆ—è¡¨
    const availableLocales = voices.map(v => v.locale);
    let selectedLocale = null;
    
    // æ£€æŸ¥åŒ¹é…çš„è¯­è¨€æ˜¯å¦åœ¨å¯ç”¨è¯­è¨€åˆ—è¡¨ä¸­
    if (matchedLocale) {
        const exactMatch = availableLocales.find(l => l === matchedLocale);
        
        if (exactMatch) {
            selectedLocale = exactMatch;
        } else {
            // å°è¯•æ¨¡ç³ŠåŒ¹é…ï¼ˆå¦‚ zh-CN åŒ¹é… zh-*ï¼‰
            const langPrefix = matchedLocale.split('-')[0];
            const fuzzyMatch = availableLocales.find(l => l.startsWith(langPrefix));
            if (fuzzyMatch) {
                selectedLocale = fuzzyMatch;
            }
        }
    }
    
    // å¦‚æœæ²¡æœ‰åŒ¹é…åˆ°ä»»ä½•è¯­è¨€ï¼Œé»˜è®¤é€‰æ‹©è‹±æ–‡
    if (!selectedLocale) {
        // å°è¯•æ‰¾ en-US
        selectedLocale = availableLocales.find(l => l === 'en-US');
        
        // å¦‚æœæ²¡æœ‰ en-USï¼Œæ‰¾ä»»ä½• en- å¼€å¤´çš„
        if (!selectedLocale) {
            selectedLocale = availableLocales.find(l => l.startsWith('en-'));
        }
        
        // å¦‚æœè¿˜æ˜¯æ²¡æœ‰ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ªå¯ç”¨è¯­è¨€
        if (!selectedLocale && availableLocales.length > 0) {
            selectedLocale = availableLocales[0];
        }
    }
    
    // è®¾ç½®é€‰ä¸­çš„è¯­è¨€
    if (selectedLocale) {
        $('#languageSelect').val(selectedLocale);
        updateVoiceList(selectedLocale);
        
        // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªé…éŸ³å‘˜
        setTimeout(() => {
            const firstVoice = $('#voiceSelect option:eq(1)').val();
            if (firstVoice) {
                $('#voiceSelect').val(firstVoice);
            }
        }, 100);
    }
}

function updateVoiceList(selectedLanguage) {
    const voiceSelect = $('#voiceSelect');
    voiceSelect.empty().append('<option value="">é€‰æ‹©é…éŸ³å‘˜...</option>');
    if (selectedLanguage) {
        const filteredVoices = voices.filter(v => v.locale === selectedLanguage);
        filteredVoices.forEach(voice => {
            const displayName = voice.shortName || voice.name;
            voiceSelect.append(`<option value="${voice.shortName}">${displayName} (${voice.gender})</option>`);
        });
    }
}

function convertText() {
    const text = $('#textInput').val().trim();
    const voiceId = $('#voiceSelect').val();
    const language = $('#languageSelect').val();
    const pitch = parseInt($('#pitchRange').val());
    const rate = parseInt($('#rateRange').val());
    const volume = parseInt($('#volumeRange').val());
    const generateSubtitles = $('#generateSubtitles').is(':checked');
    
    // é«˜çº§åŠŸèƒ½å‚æ•°
    const previewMode = $('#previewMode').is(':checked');
    const previewSentences = parseInt($('#previewSentences').val()) || 3;
    const breakTime = parseInt($('#breakTime').val()) || 0;
    const enableLongTextSplit = $('#enableLongTextSplit').is(':checked');
    const maxCharsPerChunk = parseInt($('#maxCharsPerChunk').val()) || 500;
    
    if (!text) {
        alert('è¯·è¾“å…¥è¦è½¬æ¢çš„æ–‡æœ¬');
        return;
    }
    if (!voiceId) {
        alert('è¯·é€‰æ‹©é…éŸ³å‘˜');
        return;
    }
    
    const request = {
        Text: text,
        Voice: voiceId,
        Language: language,
        Pitch: pitch,
        Rate: rate,
        Volume: volume,
        GenerateSubtitles: generateSubtitles,
        // é«˜çº§åŠŸèƒ½
        PreviewMode: previewMode,
        PreviewSentences: previewSentences,
        BreakTime: breakTime,
        EnableLongTextSplit: enableLongTextSplit,
        MaxCharsPerChunk: maxCharsPerChunk
    };
    
    const $convertBtn = $('#convertBtn');
    $convertBtn.prop('disabled', true).find('span.truncate').text('è½¬æ¢ä¸­...');
    
    $.ajax({
        url: '/Tts/ConvertText',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(request),
        success: function(response) {
            if (response.success) {
                currentAudioData = response.audioData;
                currentSubtitles = response.subtitles;
                
                // æ˜¾ç¤ºå…ƒæ•°æ®ä¿¡æ¯
                if (response.chunkCount || response.processingTimeMs || response.isPreview) {
                    let metaInfo = [];
                    if (response.isPreview) metaInfo.push('ğŸ§ è¯•å¬æ¨¡å¼');
                    if (response.chunkCount > 1) metaInfo.push(`ğŸ“„ ${response.chunkCount} ä¸ªç‰‡æ®µ`);
                    if (response.totalCharacters) metaInfo.push(`ğŸ“ ${response.totalCharacters} å­—ç¬¦`);
                    if (response.processingTimeMs) metaInfo.push(`â±ï¸ ${(response.processingTimeMs / 1000).toFixed(1)}ç§’`);
                    
                    // å¯ä»¥åœ¨é¡µé¢ä¸Šæ˜¾ç¤ºè¿™äº›ä¿¡æ¯
                }
                
                $('#inlinePlayer').show();
                
                const audioPlayer = document.getElementById('audioPlayer');
                audioPlayer.src = 'data:audio/mpeg;base64,' + currentAudioData;
                audioPlayer.onerror = function(e) {
                    alert('éŸ³é¢‘åŠ è½½å¤±è´¥');
                };
                audioPlayer.onloadedmetadata = function() {
                    updateTimeDisplay();
                };
                audioPlayer.load();
                
                if (currentSubtitles) {
                    $('#subtitlesContainer').show();
                    $('#subtitlesContent').text(currentSubtitles);
                } else {
                    $('#subtitlesContainer').hide();
                }
            } else {
                alert('è½¬æ¢å¤±è´¥: ' + response.errorMessage);
            }
        },
        error: function(xhr, status, error) {
            alert('è½¬æ¢è¯·æ±‚å¤±è´¥');
        },
        complete: function() {
            $convertBtn.prop('disabled', false).find('span.truncate').text('ç”Ÿæˆè¯­éŸ³');
        }
    });
}

function playAudio() {
    const audioPlayer = document.getElementById('audioPlayer');
    const $playBtn = $('#playBtn .material-symbols-outlined');
    if (audioPlayer.paused) {
        audioPlayer.play();
        $playBtn.text('pause');
    } else {
        audioPlayer.pause();
        $playBtn.text('play_arrow');
    }
}

function updateProgress() {
    const audioPlayer = document.getElementById('audioPlayer');
    if (audioPlayer.duration) {
        const progress = (audioPlayer.currentTime / audioPlayer.duration) * 100;
        $('#progressBar').css('width', progress + '%');
        updateTimeDisplay();
    }
}

function updateTimeDisplay() {
    const audioPlayer = document.getElementById('audioPlayer');
    const current = formatTime(audioPlayer.currentTime);
    const duration = formatTime(audioPlayer.duration);
    $('#timeDisplay').text(current + ' / ' + duration);
}

function formatTime(seconds) {
    if (isNaN(seconds)) return '0:00';
    const mins = Math.floor(seconds / 60);
    const secs = Math.floor(seconds % 60);
    return mins + ':' + (secs < 10 ? '0' : '') + secs;
}

function downloadAudio() {
    if (currentAudioData) {
        const a = document.createElement('a');
        a.href = 'data:audio/mpeg;base64,' + currentAudioData;
        a.download = 'tts_audio_' + new Date().getTime() + '.mp3';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
}

function downloadSubtitles() {
    if (currentSubtitles) {
        const a = document.createElement('a');
        a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(currentSubtitles);
        a.download = 'tts_subtitles_' + new Date().getTime() + '.srt';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
}
</script>
}